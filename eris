#!/bin/sh

completion='compctl -k "(help bash-completion ssh mount mount-backup unmount vnc)" eris'


case $1 in
"help")
	echo "Available options:"
	echo "=> help				Shows this"
	echo "=> [ssh] [cmd]			Connects via ssh"
	echo "=> vnc				Opens a vnc session"
	echo "=> mount			Mount the shared folders"
	echo "=> mount-backup			Mount the backup folder"
	echo "=> unmount			Unmount the shared folders"
	;;

"bash-completion")
	echo "$completion"
	;;

"mount")
    mkdir -p /media/eris/seagate2
	sshfs -o idmap=user -o uid=$(id -u) -o gid=$(id -g) eris:/media/seagate2 /media/eris/seagate2

    mkdir -p /media/eris/btrfs
	sshfs -o idmap=user -o uid=$(id -u) -o gid=$(id -g) eris:/media/btrfs3-new /media/eris/btrfs

    mkdir -p /media/eris/backups
	sshfs -o idmap=user -o uid=$(id -u) -o gid=$(id -g) eris:/media/btrfs3-new/backups /media/eris/backups
	;;

"mount-backup")
	mkdir -p /media/eris/backups
	sshfs -o idmap=user -o uid=$(id -u) -o gid=$(id -g) eris:/media/btrfs3-new/backups /media/eris/backups
	;;

"unmount")
    for f in /media/eris/*; do fusermount -u $f; done
	;;


"vnc")
	ssh -N -p 443 -L 5900:localhost:5900 ssh.rossogilvie.id.au &
	vncviewer -encodings "copyrect tight zrle hextile zlib corre rre raw" localhost
	;;

"ssh")
	shift 1
	cmd=$*
	ssh eris $cmd && /home/ross/.scripts/fix-mouse
	;;

*)
	ssh eris && /home/ross/.scripts/fix-mouse
	;;

esac
